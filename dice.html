<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>骰動之間 吃到堡 挑戰登記</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; 
      padding: 20px 15px; 
      max-width: 500px; 
      margin: 0 auto; 
      background: linear-gradient(135deg, #1a2980, #26d0ce);
      min-height: 100vh;
      color: white;
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .container {
      background: rgba(255, 255, 255, 0.12);
      padding: 25px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 35px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
    }
    
    .header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
      color: #FFEA00;
      line-height: 1.3;
    }
    
    .title-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .title-icon {
      font-size: 2.2rem;
      animation: bounce 2s infinite;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    .input-group {
      margin-bottom: 25px;
    }
    
    label {
      display: block;
      margin-bottom: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    input { 
      width: 100%; 
      font-size: 1.1rem; 
      padding: 14px 18px; 
      border: none;
      border-radius: 12px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.95);
      color: #222;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.1), 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
      font-weight: 600;
      letter-spacing: 1px;
    }
    
    input:focus {
      outline: none;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.1), 0 0 0 3px rgba(255, 215, 0, 0.6);
      transform: scale(1.02);
    }
    
    input::placeholder {
      color: #888;
      font-weight: normal;
    }
    
    button {
      width: 100%; 
      font-size: 1.2rem; 
      padding: 16px; 
      border: none;
      border-radius: 12px;
      background: linear-gradient(45deg, #FF416C, #FF4B2B);
      color: white;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 1px;
      box-shadow: 0 6px 20px rgba(255, 75, 43, 0.4);
      margin-top: 10px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 75, 43, 0.6);
    }
    
    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 3px 15px rgba(255, 75, 43, 0.4);
    }
    
    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    #result { 
      margin-top: 20px; 
      padding: 18px; 
      border-radius: 12px; 
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      line-height: 1.6;
      opacity: 0;
      transform: translateY(15px);
      transition: all 0.4s ease;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #result.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .success { 
      background: linear-gradient(135deg, #00b09b, #96c93d);
      box-shadow: 0 4px 15px rgba(0, 176, 155, 0.3);
    }
    
    .error { 
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
    }
    
    .loading { 
      background: linear-gradient(135deg, #ffd200, #f7971e);
      box-shadow: 0 4px 15px rgba(255, 210, 0, 0.3);
      color: #333;
    }
    
    .instructions {
      background: rgba(0, 0, 0, 0.2);
      padding: 18px;
      border-radius: 12px;
      margin-top: 25px;
      font-size: 0.95rem;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .instructions h3 {
      margin-top: 0;
      margin-bottom: 12px;
      color: #FFEA00;
      text-align: center;
      font-size: 1.15rem;
    }
    
    .instructions ul {
      padding-left: 22px;
      margin-bottom: 0;
    }
    
    .instructions li {
      margin-bottom: 10px;
      line-height: 1.5;
    }
    
    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 0.85rem;
      opacity: 0.85;
      line-height: 1.6;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 15px 10px;
        justify-content: flex-start;
        padding-top: 30px;
      }
      
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.6rem;
      }
      
      .title-icon {
        font-size: 1.9rem;
      }
      
      input, button {
        padding: 14px;
        font-size: 1.05rem;
      }
      
      #result {
        padding: 16px;
        font-size: 1rem;
        min-height: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title-container">
        <span class="title-icon">🎲</span>
        <h1>骰動之間<br>吃到堡挑戰登記</h1>
        <span class="title-icon">🍔</span>
      </div>
    </div>
    
    <div class="input-group">
      <label for="nameTail">請輸入姓名末兩字</label>
      <input 
        id="nameTail" 
        type="text" 
        maxlength="2" 
        placeholder="例如：小明"
        autocomplete="off"
        autocapitalize="characters"
      />
      <button id="submitBtn" onclick="submitChallenge()">
        <span>🚀</span> 提交挑戰
      </button>
    </div>
    
    <div id="result"></div>
    
    <div class="instructions">
      <h3>挑戰規則說明</h3>
      <ul>
        <li><strong>每日限挑戰1次</strong>（00:00-23:59）</li>
        <li><strong>連續6次未中斷</strong>可兌換吃到堡</li>
        <li>中斷後（間隔超過7天）計數重置</li>
        <li>輸入時請使用姓名最後兩個字</li>
      </ul>
    </div>
    
    <div class="footer">
      <p>骰動之間 © 2023 - 挑戰系統</p>
      <p>部署版本：16版 (2025-07-29)</p>
      <p>部署ID: AKfycbxqhrFFd9IkHSFXIteU2B7x7l7mnZGq_UrwsyRyMNKIFaGa1o90kpbdHI3xfd6yaNKsNQ</p>
    </div>
  </div>
  
  <script>
    // 使用新的部署URL
    const API_URL = 'https://script.google.com/macros/s/AKfycbxqhrFFd9IkHSFXIteU2B7x7l7mnZGq_UrwsyRyMNKIFaGa1o90kpbdHI3xfd6yaNKsNQ/exec';
    
    function submitChallenge() {
      const nameTailInput = document.getElementById("nameTail");
      const nameTail = nameTailInput.value.trim().toUpperCase();
      const submitBtn = document.getElementById("submitBtn");
      const resultDiv = document.getElementById("result");
      
      // 清除之前的结果
      resultDiv.className = '';
      resultDiv.classList.remove('show');
      resultDiv.textContent = '';
      
      // 验证输入
      if (!nameTail || nameTail.length !== 2) {
        showResult("請輸入完整姓名末兩字", "error");
        nameTailInput.focus();
        return;
      }
      
      // 显示加载状态
      submitBtn.disabled = true;
      submitBtn.innerHTML = "<span>⏳</span> 提交中...";
      showResult("正在提交挑戰，請稍候...", "loading");
      
      // 使用 GET 方法发送请求
      const url = `${API_URL}?nameTail=${encodeURIComponent(nameTail)}`;
      
      // 添加时间戳避免缓存
      const timestamp = new Date().getTime();
      const uniqueUrl = `${url}&_=${timestamp}`;
      
      fetch(uniqueUrl)
        .then(response => {
          if (!response.ok) throw new Error('網路請求失敗');
          return response.text();
        })
        .then(text => {
          if (text.includes("登記成功")) {
            showResult("🎉 " + text, "success");
            nameTailInput.value = "";
            
            // 添加庆祝效果
            resultDiv.style.animation = "celebrate 0.5s ease 2";
            setTimeout(() => {
              resultDiv.style.animation = "";
            }, 1000);
          } else if (text.includes("今天已參加")) {
            showResult("⏳ " + text, "error");
          } else if (text.includes("錯誤")) {
            showResult("⚠️ " + text, "error");
          } else {
            showResult(text, "error");
          }
        })
        .catch(err => {
          console.error('提交錯誤:', err);
          showResult("❌ 提交失敗，請檢查網路連線或稍後再試", "error");
        })
        .finally(() => {
          submitBtn.disabled = false;
          submitBtn.innerHTML = "<span>🚀</span> 提交挑戰";
          nameTailInput.focus();
        });
    }
    
    function showResult(message, type) {
      const resultDiv = document.getElementById("result");
      resultDiv.textContent = message;
      resultDiv.className = type;
      
      // 添加显示动画
      setTimeout(() => {
        resultDiv.classList.add('show');
      }, 10);
    }
    
    // 按 Enter 键提交
    document.getElementById("nameTail").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        submitChallenge();
      }
    });
    
    // 页面加载时聚焦输入框
    window.onload = function() {
      document.getElementById("nameTail").focus();
      
      // 添加背景动画
      document.body.style.animation = "gradientBG 15s ease infinite";
    };
    
    // 添加庆祝动画
    const style = document.createElement('style');
    style.textContent = `
      @keyframes celebrate {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
